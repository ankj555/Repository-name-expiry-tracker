#:kivy 2.0.0
#:import Factory kivy.factory.Factory

# å…¨å±€æ ·å¼å®šä¹‰
<Label>:
    font_name: 'Chinese'
    color: 0.2, 0.2, 0.2, 1

<Button>:
    font_name: 'Chinese'
    background_normal: ''
    background_down: ''
    size_hint_min_y: '48dp'
    canvas.before:
        Color:
            rgba: self.background_color if hasattr(self, 'background_color') else (0.2, 0.6, 1, 1)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [15,]
    canvas.after:
        Color:
            rgba: 0, 0, 0, 0.1
        Line:
            rounded_rectangle: [self.pos[0], self.pos[1], self.size[0], self.size[1], 15]
            width: 1

<TextInput>:
    font_name: 'Chinese'
    background_normal: ''
    background_active: ''
    canvas.before:
        Color:
            rgba: 0.95, 0.95, 0.95, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [10,]
        Color:
            rgba: 0.8, 0.8, 0.8, 1
        Line:
            rounded_rectangle: [self.pos[0], self.pos[1], self.size[0], self.size[1], 10]
            width: 1

# è‡ªå®šä¹‰å¡ç‰‡ç»„ä»¶
<Card@BoxLayout>:
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [15,]
        Color:
            rgba: 0, 0, 0, 0.1
        RoundedRectangle:
            pos: self.x + 2, self.y - 2
            size: self.width, self.height
            radius: [15,]
    padding: '15dp'
    spacing: '10dp'

# ä¸»ç•Œé¢
<HomeScreen>:
    canvas.before:
        Color:
            rgba: 0.95, 0.97, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: 'vertical'
        padding: '20dp'
        spacing: '20dp'
        
        # é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ
        Card:
            size_hint_y: None
            height: '120dp'
            orientation: 'vertical'
            
            Label:
                text: 'æ™ºèƒ½æ¡ç æ‰«æå™¨'
                font_size: '28sp'
                bold: True
                color: 0.2, 0.6, 1, 1
                size_hint_y: None
                height: '40dp'
            
            Label:
                text: 'äº§å“ä¿è´¨æœŸç®¡ç†ç³»ç»Ÿ'
                font_size: '16sp'
                color: 0.5, 0.5, 0.5, 1
                size_hint_y: None
                height: '30dp'
            
            # ç»Ÿè®¡ä¿¡æ¯
            BoxLayout:
                size_hint_y: None
                height: '30dp'
                spacing: '20dp'
                
                Label:
                    id: total_products
                    text: 'æ€»äº§å“: 0'
                    font_size: '14sp'
                    color: 0.3, 0.3, 0.3, 1
                
                Label:
                    id: expiring_soon
                    text: 'å³å°†è¿‡æœŸ: 0'
                    font_size: '14sp'
                    color: 1, 0.5, 0, 1
        
        # åŠŸèƒ½æŒ‰é’®åŒºåŸŸ
        GridLayout:
            cols: 2
            spacing: '15dp'
            size_hint_y: None
            height: '300dp'
            
            Card:
                orientation: 'vertical'
                
                Widget:
                    size_hint_y: 0.3
                
                Label:
                    text: 'ğŸ“±'
                    font_size: '40sp'
                    size_hint_y: None
                    height: '60dp'
                
                Button:
                    text: 'æ‰«ææ¡ç '
                    font_size: '18sp'
                    size_hint_y: None
                    height: '50dp'
                    background_color: 0.2, 0.6, 1, 1
                    on_release: root.manager.current = 'scan'
                
                Widget:
                    size_hint_y: 0.3
            
            Card:
                orientation: 'vertical'
                
                Widget:
                    size_hint_y: 0.3
                
                Label:
                    text: 'ğŸ“‹'
                    font_size: '40sp'
                    size_hint_y: None
                    height: '60dp'
                
                Button:
                    text: 'äº§å“åˆ—è¡¨'
                    font_size: '18sp'
                    size_hint_y: None
                    height: '50dp'
                    background_color: 0.2, 0.8, 0.2, 1
                    on_release: root.manager.current = 'product_list'
                
                Widget:
                    size_hint_y: 0.3
            
            Card:
                orientation: 'vertical'
                
                Widget:
                    size_hint_y: 0.3
                
                Label:
                    text: 'â•'
                    font_size: '40sp'
                    size_hint_y: None
                    height: '60dp'
                
                Button:
                    text: 'æ·»åŠ äº§å“'
                    font_size: '18sp'
                    size_hint_y: None
                    height: '50dp'
                    background_color: 0.8, 0.4, 1, 1
                    on_release: root.manager.current = 'add_product'
                
                Widget:
                    size_hint_y: 0.3
            
            Card:
                orientation: 'vertical'
                
                Widget:
                    size_hint_y: 0.3
                
                Label:
                    text: 'âš™ï¸'
                    font_size: '40sp'
                    size_hint_y: None
                    height: '60dp'
                
                Button:
                    text: 'è®¾ç½®'
                    font_size: '18sp'
                    size_hint_y: None
                    height: '50dp'
                    background_color: 0.8, 0.6, 0.2, 1
                    on_release: root.manager.current = 'settings'
                
                Widget:
                    size_hint_y: 0.3
        
        Widget:

# æ‰«æç•Œé¢
<ScanScreen>:
    canvas.before:
        Color:
            rgba: 0.95, 0.97, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: 'vertical'
        padding: '10dp'
        spacing: '10dp'
        
        # é¡¶éƒ¨å¯¼èˆª
        BoxLayout:
            size_hint_y: None
            height: '60dp'
            spacing: '10dp'
            
            Button:
                text: 'â† è¿”å›'
                size_hint_x: None
                width: '100dp'
                background_color: 0.6, 0.6, 0.6, 1
                on_release: root.manager.current = 'home'
            
            Label:
                text: 'æ‰«ææ¡ç å’Œæ—¥æœŸ'
                font_size: '20sp'
                bold: True
                color: 0.2, 0.6, 1, 1
        
        # ç›¸æœºé¢„è§ˆåŒºåŸŸ
        Card:
            id: camera_preview
            size_hint_y: 0.4
            
            Label:
                text: 'ç›¸æœºé¢„è§ˆåŒºåŸŸ\nç‚¹å‡»å¼€å§‹æ‰«æ'
                font_size: '16sp'
                color: 0.5, 0.5, 0.5, 1
                halign: 'center'
        
        # æ‰«æç»“æœåŒºåŸŸ
        Card:
            orientation: 'vertical'
            size_hint_y: 0.6
            
            Label:
                text: 'æ‰«æç»“æœ'
                font_size: '18sp'
                bold: True
                size_hint_y: None
                height: '40dp'
                color: 0.2, 0.6, 1, 1
            
            GridLayout:
                cols: 2
                spacing: '10dp'
                size_hint_y: None
                height: self.minimum_height
                
                Label:
                    text: 'äº§å“åç§°:'
                    size_hint_y: None
                    height: '35dp'
                    halign: 'right'
                    text_size: self.width, None
                    font_size: '14sp'
                
                Label:
                    id: product_name
                    text: 'æœªè¯†åˆ«'
                    size_hint_y: None
                    height: '35dp'
                    halign: 'left'
                    text_size: self.width, None
                    font_size: '14sp'
                    color: 0.2, 0.6, 1, 1
                
                Label:
                    text: 'æ¡ç :'
                    size_hint_y: None
                    height: '35dp'
                    halign: 'right'
                    text_size: self.width, None
                    font_size: '14sp'
                
                Label:
                    id: product_code
                    text: 'æœªæ‰«æ'
                    size_hint_y: None
                    height: '35dp'
                    halign: 'left'
                    text_size: self.width, None
                    font_size: '14sp'
                    color: 0.2, 0.6, 1, 1
                
                Label:
                    text: 'ç”Ÿäº§æ—¥æœŸ:'
                    size_hint_y: None
                    height: '35dp'
                    halign: 'right'
                    text_size: self.width, None
                    font_size: '14sp'
                
                Label:
                    id: production_date
                    text: 'æœªè¯†åˆ«'
                    size_hint_y: None
                    height: '35dp'
                    halign: 'left'
                    text_size: self.width, None
                    font_size: '14sp'
                    color: 0.2, 0.6, 1, 1
                
                Label:
                    text: 'è¿‡æœŸæ—¥æœŸ:'
                    size_hint_y: None
                    height: '35dp'
                    halign: 'right'
                    text_size: self.width, None
                    font_size: '14sp'
                
                Label:
                    id: expiry_date
                    text: 'æœªè®¡ç®—'
                    size_hint_y: None
                    height: '35dp'
                    halign: 'left'
                    text_size: self.width, None
                    font_size: '14sp'
                    color: 0.2, 0.6, 1, 1
                
                Label:
                    text: 'å‰©ä½™å¤©æ•°:'
                    size_hint_y: None
                    height: '35dp'
                    halign: 'right'
                    text_size: self.width, None
                    font_size: '14sp'
                
                Label:
                    id: days_remaining
                    text: 'æœªè®¡ç®—'
                    size_hint_y: None
                    height: '35dp'
                    halign: 'left'
                    text_size: self.width, None
                    font_size: '14sp'
                    color: 0.2, 0.6, 1, 1
            
            Label:
                id: error_label
                text: ''
                color: 1, 0, 0, 1
                size_hint_y: None
                height: '30dp'
            
            # æ‰‹åŠ¨è¾“å…¥åŒºåŸŸ
            BoxLayout:
                id: manual_date_input
                orientation: 'horizontal'
                size_hint_y: None
                height: '50dp'
                spacing: '10dp'
                opacity: 0
                
                TextInput:
                    id: manual_date
                    hint_text: 'YYYY-MM-DD'
                    multiline: False
                    size_hint_x: 0.7
                
                Button:
                    text: 'ç¡®è®¤'
                    size_hint_x: 0.3
                    background_color: 0.2, 0.8, 0.2, 1
                    on_release: root.on_date_recognized(manual_date.text)
            
            # æ“ä½œæŒ‰é’®
            BoxLayout:
                size_hint_y: None
                height: '60dp'
                spacing: '10dp'
                
                Button:
                    text: 'æ‰‹åŠ¨è¾“å…¥æ—¥æœŸ'
                    background_color: 0.8, 0.6, 0.2, 1
                    on_release: manual_date_input.opacity = 1 if manual_date_input.opacity == 0 else 0
                
                Button:
                    text: 'ä¿å­˜è®°å½•'
                    background_color: 0.2, 0.8, 0.2, 1
                    disabled: not (product_name.text != 'æœªè¯†åˆ«' and production_date.text != 'æœªè¯†åˆ«')
                    on_release: root.save_product_record()

# äº§å“åˆ—è¡¨ç•Œé¢
<ProductListScreen>:
    canvas.before:
        Color:
            rgba: 0.95, 0.97, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: 'vertical'
        padding: '10dp'
        spacing: '10dp'
        
        # é¡¶éƒ¨å¯¼èˆªå’Œæœç´¢
        BoxLayout:
            size_hint_y: None
            height: '60dp'
            spacing: '10dp'
            
            Button:
                text: 'â† è¿”å›'
                size_hint_x: None
                width: '100dp'
                background_color: 0.6, 0.6, 0.6, 1
                on_release: root.manager.current = 'home'
            
            Label:
                text: 'äº§å“åˆ—è¡¨'
                font_size: '20sp'
                bold: True
                color: 0.2, 0.6, 1, 1
        
        # ç­›é€‰å’Œæ’åº
        Card:
            size_hint_y: None
            height: '80dp'
            orientation: 'horizontal'
            
            Label:
                text: 'æ’åº:'
                size_hint_x: None
                width: '60dp'
                font_size: '14sp'
            
            Spinner:
                id: sort_spinner
                text: 'å‰©ä½™å¤©æ•°'
                values: ['å‰©ä½™å¤©æ•°', 'äº§å“åç§°', 'è¿‡æœŸæ—¥æœŸ', 'æ·»åŠ æ—¶é—´']
                size_hint_x: 0.3
                font_size: '14sp'
                on_text: root.refresh_product_list(self.text)
            
            Widget:
                size_hint_x: 0.05
            
            Button:
                text: 'ğŸ”„ åˆ·æ–°'
                size_hint_x: None
                width: '80dp'
                background_color: 0.2, 0.6, 1, 1
                font_size: '12sp'
                on_release: root.refresh_product_list()
        
        # å¯¼å…¥å¯¼å‡ºåŠŸèƒ½
        Card:
            size_hint_y: None
            height: '60dp'
            orientation: 'horizontal'
            
            Button:
                text: 'ğŸ“¤ å¯¼å‡ºè¡¨æ ¼'
                size_hint_x: 0.5
                background_color: 0.2, 0.8, 0.4, 1
                font_size: '14sp'
                on_release: root.export_to_excel()
            
            Widget:
                size_hint_x: 0.05
            
            Button:
                text: 'ğŸ“¥ å¯¼å…¥è¡¨æ ¼'
                size_hint_x: 0.5
                background_color: 0.8, 0.4, 0.2, 1
                font_size: '14sp'
                on_release: root.import_from_excel()
        
        # äº§å“åˆ—è¡¨
        ScrollView:
            GridLayout:
                id: product_list
                cols: 1
                spacing: '10dp'
                size_hint_y: None
                height: self.minimum_height
                padding: '5dp'

# äº§å“åˆ—è¡¨é¡¹
<ProductListItem>:
    size_hint_y: None
    height: '120dp'
    
    Card:
        canvas.before:
            Color:
                rgba: (0.9, 1, 0.9, 1) if root.days_remaining > 30 else ((1, 0.95, 0.8, 1) if root.days_remaining > 7 else (1, 0.9, 0.9, 1))
            RoundedRectangle:
                pos: self.pos
                size: self.size
                radius: [15,]
        
        BoxLayout:
            orientation: 'vertical'
            spacing: '5dp'
            
            # äº§å“åç§°
            Label:
                text: root.product_name
                font_size: '16sp'
                bold: True
                halign: 'left'
                valign: 'middle'
                text_size: self.width, None
                size_hint_y: None
                height: '30dp'
                color: 0.2, 0.2, 0.2, 1
            
            # è¯¦ç»†ä¿¡æ¯
            BoxLayout:
                size_hint_y: None
                height: '50dp'
                spacing: '10dp'
                
                BoxLayout:
                    orientation: 'vertical'
                    
                    Label:
                        text: f'æ¡ç : {root.barcode}'
                        font_size: '12sp'
                        halign: 'left'
                        text_size: self.width, None
                        color: 0.5, 0.5, 0.5, 1
                    
                    Label:
                        text: f'ç”Ÿäº§: {root.production_date}'
                        font_size: '12sp'
                        halign: 'left'
                        text_size: self.width, None
                        color: 0.5, 0.5, 0.5, 1
                    
                    Label:
                        text: f'è¿‡æœŸ: {root.expiry_date}'
                        font_size: '12sp'
                        halign: 'left'
                        text_size: self.width, None
                        color: 0.5, 0.5, 0.5, 1
                
                # å‰©ä½™å¤©æ•°æ˜¾ç¤º
                BoxLayout:
                    size_hint_x: None
                    width: '100dp'
                    orientation: 'vertical'
                    
                    Label:
                        text: 'å‰©ä½™å¤©æ•°'
                        font_size: '12sp'
                        color: 0.5, 0.5, 0.5, 1
                    
                    Label:
                        text: f'{root.days_remaining}å¤©'
                        font_size: '18sp'
                        bold: True
                        color: (0, 0.7, 0, 1) if root.days_remaining > 30 else ((0.8, 0.5, 0, 1) if root.days_remaining > 7 else (0.8, 0, 0, 1))

# æ·»åŠ äº§å“ç•Œé¢
<AddProductScreen>:
    canvas.before:
        Color:
            rgba: 0.95, 0.97, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: 'vertical'
        padding: '10dp'
        spacing: '10dp'
        
        # é¡¶éƒ¨å¯¼èˆª
        BoxLayout:
            size_hint_y: None
            height: '60dp'
            spacing: '10dp'
            
            Button:
                text: 'â† è¿”å›'
                size_hint_x: None
                width: '100dp'
                background_color: 0.6, 0.6, 0.6, 1
                on_release: root.manager.current = 'scan'
            
            Label:
                text: 'æ·»åŠ æ–°äº§å“'
                font_size: '20sp'
                bold: True
                color: 0.2, 0.6, 1, 1
        
        # è¾“å…¥è¡¨å•
        Card:
            orientation: 'vertical'
            
            GridLayout:
                cols: 2
                spacing: '15dp'
                size_hint_y: None
                height: self.minimum_height
                
                Label:
                    text: 'æ¡ç :'
                    size_hint_y: None
                    height: '50dp'
                    halign: 'right'
                    text_size: self.width, None
                    font_size: '16sp'
                
                TextInput:
                    id: barcode_input
                    multiline: False
                    size_hint_y: None
                    height: '50dp'
                    font_size: '16sp'
                
                Label:
                    text: 'äº§å“åç§°:'
                    size_hint_y: None
                    height: '50dp'
                    halign: 'right'
                    text_size: self.width, None
                    font_size: '16sp'
                
                TextInput:
                    id: name_input
                    multiline: False
                    size_hint_y: None
                    height: '50dp'
                    font_size: '16sp'
                
                Label:
                    text: 'ä¿è´¨æœŸ(å¤©):'
                    size_hint_y: None
                    height: '50dp'
                    halign: 'right'
                    text_size: self.width, None
                    font_size: '16sp'
                
                TextInput:
                    id: shelf_life_input
                    multiline: False
                    input_filter: 'int'
                    text: '365'
                    size_hint_y: None
                    height: '50dp'
                    font_size: '16sp'
                
                Label:
                    text: 'é€€è´§æœŸé™(å¤©):'
                    size_hint_y: None
                    height: '50dp'
                    halign: 'right'
                    text_size: self.width, None
                    font_size: '16sp'
                
                TextInput:
                    id: return_days_input
                    multiline: False
                    input_filter: 'int'
                    text: '7'
                    size_hint_y: None
                    height: '50dp'
                    font_size: '16sp'
            
            Label:
                id: error_label
                text: ''
                color: 1, 0, 0, 1
                size_hint_y: None
                height: '40dp'
            
            Button:
                text: 'ğŸ’¾ ä¿å­˜äº§å“ä¿¡æ¯'
                size_hint_y: None
                height: '60dp'
                font_size: '18sp'
                background_color: 0.2, 0.8, 0.2, 1
                on_release: root.add_product()
        
        Widget:

# è®¾ç½®ç•Œé¢
<SettingsScreen>:
    canvas.before:
        Color:
            rgba: 0.95, 0.97, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: 'vertical'
        padding: '10dp'
        spacing: '10dp'
        
        # é¡¶éƒ¨å¯¼èˆª
        BoxLayout:
            size_hint_y: None
            height: '60dp'
            spacing: '10dp'
            
            Button:
                text: 'â† è¿”å›'
                size_hint_x: None
                width: '100dp'
                background_color: 0.6, 0.6, 0.6, 1
                on_release: root.manager.current = 'home'
            
            Label:
                text: 'ç³»ç»Ÿè®¾ç½®'
                font_size: '20sp'
                bold: True
                color: 0.2, 0.6, 1, 1
        
        # è®¾ç½®é€‰é¡¹
        Card:
            orientation: 'vertical'
            
            GridLayout:
                cols: 2
                spacing: '15dp'
                size_hint_y: None
                height: self.minimum_height
                
                Label:
                    text: 'é»˜è®¤é€€è´§æœŸé™(å¤©):'
                    size_hint_y: None
                    height: '50dp'
                    halign: 'right'
                    text_size: self.width, None
                    font_size: '16sp'
                
                TextInput:
                    id: default_return_days
                    multiline: False
                    input_filter: 'int'
                    text: '7'
                    size_hint_y: None
                    height: '50dp'
                    font_size: '16sp'
                
                Label:
                    text: 'æœåŠ¡å™¨åœ°å€:'
                    size_hint_y: None
                    height: '50dp'
                    halign: 'right'
                    text_size: self.width, None
                    font_size: '16sp'
                
                TextInput:
                    id: server_address
                    multiline: False
                    hint_text: 'http://192.168.1.100:8000'
                    size_hint_y: None
                    height: '50dp'
                    font_size: '16sp'
            
            Label:
                id: status_label
                text: ''
                size_hint_y: None
                height: '40dp'
                color: 0.2, 0.6, 1, 1
            
            BoxLayout:
                size_hint_y: None
                height: '70dp'
                spacing: '10dp'
                
                Button:
                    text: 'ğŸ’¾ ä¿å­˜è®¾ç½®'
                    background_color: 0.2, 0.6, 1, 1
                    font_size: '16sp'
                    on_release: root.save_settings()
                
                Button:
                    text: 'ğŸ”„ åŒæ­¥æ•°æ®'
                    background_color: 0.2, 0.8, 0.2, 1
                    font_size: '16sp'
                    on_release: root.sync_data()
        
        Widget:

# ç”µè„‘ç«¯æ•°æ®æŸ¥çœ‹ç•Œé¢
<DesktopViewScreen>:
    canvas.before:
        Color:
            rgba: 0.98, 0.98, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size
    
    BoxLayout:
        orientation: 'vertical'
        padding: '20dp'
        spacing: '15dp'
        
        # é¡¶éƒ¨æ ‡é¢˜å’Œç»Ÿè®¡
        Card:
            size_hint_y: None
            height: '100dp'
            orientation: 'horizontal'
            
            BoxLayout:
                orientation: 'vertical'
                
                Label:
                    text: 'äº§å“æ•°æ®ç®¡ç†ä¸­å¿ƒ'
                    font_size: '24sp'
                    bold: True
                    color: 0.2, 0.6, 1, 1
                    size_hint_y: None
                    height: '40dp'
                
                BoxLayout:
                    size_hint_y: None
                    height: '40dp'
                    spacing: '30dp'
                    
                    Label:
                        id: desktop_total_products
                        text: 'æ€»äº§å“: 0'
                        font_size: '16sp'
                        color: 0.3, 0.3, 0.3, 1
                    
                    Label:
                        id: desktop_expiring_soon
                        text: 'å³å°†è¿‡æœŸ: 0'
                        font_size: '16sp'
                        color: 1, 0.5, 0, 1
                    
                    Label:
                        id: desktop_expired
                        text: 'å·²è¿‡æœŸ: 0'
                        font_size: '16sp'
                        color: 1, 0, 0, 1
            
            BoxLayout:
                size_hint_x: None
                width: '200dp'
                spacing: '10dp'
                
                Button:
                    text: 'ğŸ“Š å¯¼å‡ºæ•°æ®'
                    background_color: 0.2, 0.6, 1, 1
                    on_release: root.export_data()
                
                Button:
                    text: 'ğŸ”„ åˆ·æ–°'
                    background_color: 0.2, 0.8, 0.2, 1
                    on_release: root.refresh_data()
        
        # ç­›é€‰å’Œæœç´¢
        Card:
            size_hint_y: None
            height: '80dp'
            orientation: 'horizontal'
            
            TextInput:
                id: search_input
                hint_text: 'æœç´¢äº§å“åç§°æˆ–æ¡ç ...'
                size_hint_x: 0.4
                font_size: '16sp'
                on_text: root.filter_products(self.text)
            
            Widget:
                size_hint_x: 0.1
            
            Label:
                text: 'çŠ¶æ€ç­›é€‰:'
                size_hint_x: None
                width: '100dp'
                font_size: '16sp'
            
            Spinner:
                id: status_filter
                text: 'å…¨éƒ¨'
                values: ['å…¨éƒ¨', 'æ­£å¸¸', 'å³å°†è¿‡æœŸ', 'å·²è¿‡æœŸ']
                size_hint_x: 0.2
                font_size: '16sp'
                on_text: root.filter_by_status(self.text)
            
            Widget:
                size_hint_x: 0.1
            
            Label:
                text: 'æ’åº:'
                size_hint_x: None
                width: '60dp'
                font_size: '16sp'
            
            Spinner:
                id: desktop_sort_spinner
                text: 'å‰©ä½™å¤©æ•°'
                values: ['å‰©ä½™å¤©æ•°', 'äº§å“åç§°', 'è¿‡æœŸæ—¥æœŸ', 'æ·»åŠ æ—¶é—´']
                size_hint_x: 0.2
                font_size: '16sp'
                on_text: root.sort_products(self.text)
        
        # æ•°æ®è¡¨æ ¼
        ScrollView:
            GridLayout:
                id: desktop_product_list
                cols: 1
                spacing: '5dp'
                size_hint_y: None
                height: self.minimum_height
                padding: '5dp'

# ç”µè„‘ç«¯äº§å“åˆ—è¡¨é¡¹
<DesktopProductItem>:
    size_hint_y: None
    height: '60dp'
    
    Card:
        canvas.before:
            Color:
                rgba: (0.95, 1, 0.95, 1) if root.days_remaining > 30 else ((1, 0.98, 0.9, 1) if root.days_remaining > 7 else (1, 0.95, 0.95, 1))
            RoundedRectangle:
                pos: self.pos
                size: self.size
                radius: [8,]
        
        BoxLayout:
            spacing: '15dp'
            
            # äº§å“åç§°
            Label:
                text: root.product_name
                font_size: '14sp'
                bold: True
                halign: 'left'
                text_size: self.width, None
                size_hint_x: 0.25
                color: 0.2, 0.2, 0.2, 1
            
            # æ¡ç 
            Label:
                text: root.barcode
                font_size: '12sp'
                halign: 'center'
                text_size: self.width, None
                size_hint_x: 0.2
                color: 0.4, 0.4, 0.4, 1
            
            # ç”Ÿäº§æ—¥æœŸ
            Label:
                text: root.production_date
                font_size: '12sp'
                halign: 'center'
                text_size: self.width, None
                size_hint_x: 0.15
                color: 0.4, 0.4, 0.4, 1
            
            # è¿‡æœŸæ—¥æœŸ
            Label:
                text: root.expiry_date
                font_size: '12sp'
                halign: 'center'
                text_size: self.width, None
                size_hint_x: 0.15
                color: 0.4, 0.4, 0.4, 1
            
            # å‰©ä½™å¤©æ•°
            Label:
                text: f'{root.days_remaining}å¤©'
                font_size: '14sp'
                bold: True
                halign: 'center'
                text_size: self.width, None
                size_hint_x: 0.1
                color: (0, 0.7, 0, 1) if root.days_remaining > 30 else ((0.8, 0.5, 0, 1) if root.days_remaining > 7 else (0.8, 0, 0, 1))
            
            # æ“ä½œæŒ‰é’®
            BoxLayout:
                size_hint_x: 0.15
                spacing: '5dp'
                
                Button:
                    text: 'ç¼–è¾‘'
                    font_size: '12sp'
                    background_color: 0.2, 0.6, 1, 1
                    on_release: root.edit_product()
                
                Button:
                    text: 'åˆ é™¤'
                    font_size: '12sp'
                    background_color: 1, 0.3, 0.3, 1
                    on_release: root.delete_product()